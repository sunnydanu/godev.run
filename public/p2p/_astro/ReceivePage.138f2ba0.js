import{S as ie,i as ce,s as fe,x as j,a as B,z as Q,f as K,A as F,h as A,B as L,C as z,d as p,D as G,J,G as ne,H as ue,I as de,e as y,t as oe,c as S,b as O,y as X,k as le,g as $,j as P,l as se,E as pe,K as x,n as ee}from"./toastStore.93fca1f7.js";import{C as ae,d as te,i as me,M as _e,S as be,R as he,a as ge,f as we,h as ve,j as re,w as ke,E as Ce,b as $e,Q as De,k as Ee}from"./QrModal.efa4f9b3.js";function ye(o){let t,e='<span class="loading loading-spinner loading-lg"></span> <div>Generating Answer</div>';return{c(){t=y("div"),t.innerHTML=e,this.h()},l(r){t=S(r,"DIV",{class:!0,"data-svelte-h":!0}),X(t)!=="svelte-3yajre"&&(t.innerHTML=e),this.h()},h(){$(t,"class","flex flex-col items-center justify-center gap-2")},m(r,f){A(r,t,f)},p:ee,i:ee,o:ee,d(r){r&&p(t)}}}function Se(o){let t,e=`Copy and send the answer code to the Offer or scan QR code to connect between peer. See
      <a class="link" href="${Ee+"#how-does-it-work"}" target="_blank" rel="noopener noreferrer">How does it work?</a>`,r,f,n,i,_,a,b,g,C,h,w,I,M,v,k,D,N;b=new Ce({props:{onChange:o[14]}}),w=new $e({});let V={qrData:o[4],title:"Answer QR Code"};return v=new De({props:V}),o[15](v),{c(){t=y("p"),t.innerHTML=e,r=B(),f=y("div"),n=y("input"),_=B(),a=y("div"),j(b.$$.fragment),g=B(),C=y("div"),h=y("button"),j(w.$$.fragment),I=oe("Copy Answer"),M=B(),j(v.$$.fragment),this.h()},l(s){t=S(s,"P",{"data-svelte-h":!0}),X(t)!=="svelte-2nnq1g"&&(t.innerHTML=e),r=K(s),f=S(s,"DIV",{class:!0});var c=O(f);n=S(c,"INPUT",{type:!0,class:!0}),_=K(c),a=S(c,"DIV",{class:!0});var u=O(a);Q(b.$$.fragment,u),u.forEach(p),c.forEach(p),g=K(s),C=S(s,"DIV",{class:!0});var T=O(C);h=S(T,"BUTTON",{class:!0});var H=O(h);Q(w.$$.fragment,H),I=le(H,"Copy Answer"),H.forEach(p),M=K(T),Q(v.$$.fragment,T),T.forEach(p),this.h()},h(){$(n,"type",i=o[5]?"text":"password"),$(n,"class","input input-bordered w-full"),n.value=o[4],n.readOnly=!0,$(a,"class","absolute top-0 right-0 p-1"),$(f,"class","relative mt-4"),$(h,"class","btn btn-primary gap-2"),$(C,"class","mt-4 flex gap-2")},m(s,c){A(s,t,c),A(s,r,c),A(s,f,c),P(f,n),P(f,_),P(f,a),F(b,a,null),A(s,g,c),A(s,C,c),P(C,h),F(w,h,null),P(h,I),P(C,M),F(v,C,null),k=!0,D||(N=se(h,"click",o[13]),D=!0)},p(s,c){(!k||c&32&&i!==(i=s[5]?"text":"password"))&&$(n,"type",i),(!k||c&16&&n.value!==s[4])&&(n.value=s[4]);const u={};c&32&&(u.onChange=s[14]),b.$set(u);const T={};c&16&&(T.qrData=s[4]),v.$set(T)},i(s){k||(L(b.$$.fragment,s),L(w.$$.fragment,s),L(v.$$.fragment,s),k=!0)},o(s){z(b.$$.fragment,s),z(w.$$.fragment,s),z(v.$$.fragment,s),k=!1},d(s){s&&(p(t),p(r),p(f),p(g),p(C)),G(b),G(w),o[15](null),G(v),D=!1,N()}}}function Pe(o){let t,e,r,f;const n=[Se,ye],i=[];function _(a,b){return a[4]?0:1}return t=_(o),e=i[t]=n[t](o),{c(){e.c(),r=ne()},l(a){e.l(a),r=ne()},m(a,b){i[t].m(a,b),A(a,r,b),f=!0},p(a,b){let g=t;t=_(a),t===g?i[t].p(a,b):(ue(),z(i[g],1,1,()=>{i[g]=null}),de(),e=i[t],e?e.p(a,b):(e=i[t]=n[t](a),e.c()),L(e,1),e.m(r.parentNode,r))},i(a){f||(L(e),f=!0)},o(a){z(e),f=!1},d(a){a&&p(r),i[t].d(a)}}}function Te(o){let t,e,r,f="Send",n,i,_,a,b,g,C,h,w,I="Receive",M,v,k,D,N,V,s,c,u,T,H,Y={dataChannel:o[12],rsaPub:o[3],isEncrypt:o[0],chunkSize:o[1]};D=new be({props:Y}),o[18](D);let Z={dataChannel:o[12],isEncrypt:o[0],rsa:o[2]};return c=new he({props:Z}),o[19](c),{c(){t=y("div"),e=y("button"),r=y("span"),r.textContent=f,i=B(),_=y("div"),a=y("span"),b=oe("New files"),C=B(),h=y("button"),w=y("span"),w.textContent=I,v=B(),k=y("div"),j(D.$$.fragment),V=B(),s=y("div"),j(c.$$.fragment),this.h()},l(l){t=S(l,"DIV",{class:!0});var d=O(t);e=S(d,"BUTTON",{class:!0});var q=O(e);r=S(q,"SPAN",{class:!0,"data-svelte-h":!0}),X(r)!=="svelte-3upt3h"&&(r.textContent=f),q.forEach(p),i=K(d),_=S(d,"DIV",{class:!0});var R=O(_);a=S(R,"SPAN",{class:!0});var W=O(a);b=le(W,"New files"),W.forEach(p),C=K(R),h=S(R,"BUTTON",{class:!0});var m=O(h);w=S(m,"SPAN",{class:!0,"data-svelte-h":!0}),X(w)!=="svelte-1rs7wsw"&&(w.textContent=I),m.forEach(p),R.forEach(p),d.forEach(p),v=K(l),k=S(l,"DIV",{});var U=O(k);Q(D.$$.fragment,U),U.forEach(p),V=K(l),s=S(l,"DIV",{});var E=O(s);Q(c.$$.fragment,E),E.forEach(p),this.h()},h(){$(r,"class","btm-nav-label"),$(e,"class",n="btn "+(o[8]?"btn-primary":"btn-ghost")+" flex-grow border-black border-dotted"),$(a,"class",g="indicator-item badge badge-accent animate-bounce "+(o[9]?"block":"hidden")),$(w,"class","btm-nav-label"),$(h,"class",M="btn "+(o[8]?"btn-ghost":"btn-primary")+" w-full border-black border-dotted"),$(_,"class","indicator flex-grow"),$(t,"class","flex w-full mb-4 mt-2"),k.hidden=N=!o[8],s.hidden=o[8]},m(l,d){A(l,t,d),P(t,e),P(e,r),P(t,i),P(t,_),P(_,a),P(a,b),P(_,C),P(_,h),P(h,w),A(l,v,d),A(l,k,d),F(D,k,null),A(l,V,d),A(l,s,d),F(c,s,null),u=!0,T||(H=[se(e,"click",o[16]),se(h,"click",o[17])],T=!0)},p(l,d){(!u||d&256&&n!==(n="btn "+(l[8]?"btn-primary":"btn-ghost")+" flex-grow border-black border-dotted"))&&$(e,"class",n),(!u||d&512&&g!==(g="indicator-item badge badge-accent animate-bounce "+(l[9]?"block":"hidden")))&&$(a,"class",g),(!u||d&256&&M!==(M="btn "+(l[8]?"btn-ghost":"btn-primary")+" w-full border-black border-dotted"))&&$(h,"class",M);const q={};d&4096&&(q.dataChannel=l[12]),d&8&&(q.rsaPub=l[3]),d&1&&(q.isEncrypt=l[0]),d&2&&(q.chunkSize=l[1]),D.$set(q),(!u||d&256&&N!==(N=!l[8]))&&(k.hidden=N);const R={};d&4096&&(R.dataChannel=l[12]),d&1&&(R.isEncrypt=l[0]),d&4&&(R.rsa=l[2]),c.$set(R),(!u||d&256)&&(s.hidden=l[8])},i(l){u||(L(D.$$.fragment,l),L(c.$$.fragment,l),u=!0)},o(l){z(D.$$.fragment,l),z(c.$$.fragment,l),u=!1},d(l){l&&(p(t),p(v),p(k),p(V),p(s)),o[18](null),G(D),o[19](null),G(c),T=!1,pe(H)}}}function Ae(o){let t,e,r,f;return t=new ae({props:{title:"1. Answer",isOpen:!o[11],$$slots:{default:[Pe]},$$scope:{ctx:o}}}),r=new ae({props:{title:"2. Transfer Files",isOpen:o[11],$$slots:{default:[Te]},$$scope:{ctx:o}}}),{c(){j(t.$$.fragment),e=B(),j(r.$$.fragment)},l(n){Q(t.$$.fragment,n),e=K(n),Q(r.$$.fragment,n)},m(n,i){F(t,n,i),A(n,e,i),F(r,n,i),f=!0},p(n,[i]){const _={};i&2048&&(_.isOpen=!n[11]),i&1073742896&&(_.$$scope={dirty:i,ctx:n}),t.$set(_);const a={};i&2048&&(a.isOpen=n[11]),i&1073746895&&(a.$$scope={dirty:i,ctx:n}),r.$set(a)},i(n){f||(L(t.$$.fragment,n),L(r.$$.fragment,n),f=!0)},o(n){z(t.$$.fragment,n),z(r.$$.fragment,n),f=!1},d(n){n&&p(e),G(t,n),G(r,n)}}}function Ie(o,t,e){let r=te.isEncrypt,f=te.chunkSize,n,i,_=te.iceServer,a="",b=!1,g,C,h=!1,w=!1,I;const M=new URLSearchParams(window.location.search),v=Object.fromEntries(M.entries()),k=v.s;if(k===null||!k)throw window.location.assign(window.location.origin),new Error("no sdp found");const D=v.i;D&&(_=D);const N=v.c;N&&(f=parseInt(N));const V=v.p;V?(r=!0,me(V).then(m=>{e(3,i=m)})):r=!1;const s=new RTCPeerConnection({iceServers:[{urls:_}]});let c=!1,u;s.ondatachannel=m=>{e(12,u=m.channel),e(12,u.onopen=()=>{J("Connected","success"),e(11,c=!0),I.close()},u),e(12,u.onmessage=U=>{const E=_e.decode(new Uint8Array(U.data));E.metaData!==void 0?(g.onMetaData(E.id,E.metaData),e(9,w=!0)):E.chunk!==void 0?g.onChunkData(E.id,E.chunk):E.receiveEvent!==void 0&&C.onReceiveEvent(E.id,E.receiveEvent)},u),e(12,u.onerror=()=>{J("WebRTC error","error"),e(11,c=!1)},u),e(12,u.onclose=()=>{J("Disconnected","error"),e(11,c=!1)},u)};async function T(m){const E={type:"offer",sdp:ge(m,!0)};await s.setRemoteDescription(E)}T(k);async function H(){await navigator.clipboard.writeText(a),J("Copied to clipboard","info")}async function Y(){let m="";r&&(e(2,n=await we()),m=await ve(n.publicKey)),s.onicecandidate=E=>{!E.candidate&&s.localDescription&&e(4,a=re(s.localDescription.sdp)+"|"+m)};const U=await s.createAnswer();await s.setLocalDescription(U),setTimeout(async()=>{!s.localDescription||a||(J("Timeout waiting ICE candidates"),e(4,a=re(s.localDescription.sdp)+"|"+m))},ke)}Y();const Z=m=>{e(5,b=m)};function l(m){x[m?"unshift":"push"](()=>{I=m,e(10,I)})}const d=()=>{e(8,h=!0)},q=()=>{e(9,w=!1),e(8,h=!1)};function R(m){x[m?"unshift":"push"](()=>{C=m,e(7,C)})}function W(m){x[m?"unshift":"push"](()=>{g=m,e(6,g)})}return[r,f,n,i,a,b,g,C,h,w,I,c,u,H,Z,l,d,q,R,W]}class Me extends ie{constructor(t){super(),ce(this,t,Ie,Ae,fe,{})}}export{Me as default};

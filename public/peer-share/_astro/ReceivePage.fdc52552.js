import{S as te,i as ne,s as se,x as A,a as F,z as M,f as Q,A as q,h as P,B as S,C as E,d as w,D as N,G as z,K as ae,H as J,I as oe,J as re,e as O,c as K,y as W,g as k,n as j,t as ie,b as U,k as le,j as R,l as ce}from"./toastStore.c65aafa0.js";import{C as X,A as fe,d as V,i as pe,M as ue,a as de,b as me,e as ge,f as G,w as _e,E as he,h as we,Q as be,k as $e}from"./QrModal.a8692fc1.js";function Ce(r){let e,n='<span class="loading loading-spinner loading-lg"></span> <div>Generating Pairing Key</div>';return{c(){e=O("div"),e.innerHTML=n,this.h()},l(s){e=K(s,"DIV",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-140r8rr"&&(e.innerHTML=n),this.h()},h(){k(e,"class","flex flex-col items-center justify-center gap-2")},m(s,i){P(s,e,i)},p:j,i:j,o:j,d(s){s&&w(e)}}}function ye(r){let e,n=`Copy and send the Pairing Key or scan QR code to connect between peer. See
        <a class="link" href="${$e+"#how-does-it-work"}" target="_blank" rel="noopener noreferrer">How does it work?</a>`,s,i,t,l,d,a,f,g,_,b,h,D,L,m,y,I,B;f=new he({props:{onChange:r[14]}}),h=new we({});let $={qrData:r[2],title:"Pairing Key QR Code"};return m=new be({props:$}),r[15](m),{c(){e=O("p"),e.innerHTML=n,s=F(),i=O("div"),t=O("input"),d=F(),a=O("div"),A(f.$$.fragment),g=F(),_=O("div"),b=O("button"),A(h.$$.fragment),D=ie("Copy Pairing Key"),L=F(),A(m.$$.fragment),this.h()},l(o){e=K(o,"P",{"data-svelte-h":!0}),W(e)!=="svelte-104hzz8"&&(e.innerHTML=n),s=Q(o),i=K(o,"DIV",{class:!0});var c=U(i);t=K(c,"INPUT",{type:!0,class:!0}),d=Q(c),a=K(c,"DIV",{class:!0});var T=U(a);M(f.$$.fragment,T),T.forEach(w),c.forEach(w),g=Q(o),_=K(o,"DIV",{class:!0});var v=U(_);b=K(v,"BUTTON",{class:!0});var H=U(b);M(h.$$.fragment,H),D=le(H,"Copy Pairing Key"),H.forEach(w),L=Q(v),M(m.$$.fragment,v),v.forEach(w),this.h()},h(){k(t,"type",l=r[3]?"text":"password"),k(t,"class","input input-bordered w-full"),t.value=r[2],t.readOnly=!0,k(a,"class","absolute top-0 right-0 p-1"),k(i,"class","relative mt-4"),k(b,"class","btn btn-primary gap-2"),k(_,"class","mt-4 flex gap-2")},m(o,c){P(o,e,c),P(o,s,c),P(o,i,c),R(i,t),R(i,d),R(i,a),q(f,a,null),P(o,g,c),P(o,_,c),R(_,b),q(h,b,null),R(b,D),R(_,L),q(m,_,null),y=!0,I||(B=ce(b,"click",r[12]),I=!0)},p(o,c){(!y||c&8&&l!==(l=o[3]?"text":"password"))&&k(t,"type",l),(!y||c&4&&t.value!==o[2])&&(t.value=o[2]);const T={};c&8&&(T.onChange=o[14]),f.$set(T);const v={};c&4&&(v.qrData=o[2]),m.$set(v)},i(o){y||(S(f.$$.fragment,o),S(h.$$.fragment,o),S(m.$$.fragment,o),y=!0)},o(o){E(f.$$.fragment,o),E(h.$$.fragment,o),E(m.$$.fragment,o),y=!1},d(o){o&&(w(e),w(s),w(i),w(g),w(_)),N(f),N(h),r[15](null),N(m),I=!1,B()}}}function ve(r){let e,n,s,i;const t=[ye,Ce],l=[];function d(a,f){return a[2]?0:1}return e=d(r),n=l[e]=t[e](r),{c(){n.c(),s=J()},l(a){n.l(a),s=J()},m(a,f){l[e].m(a,f),P(a,s,f),i=!0},p(a,f){let g=e;e=d(a),e===g?l[e].p(a,f):(oe(),E(l[g],1,1,()=>{l[g]=null}),re(),n=l[e],n?n.p(a,f):(n=l[e]=t[e](a),n.c()),S(n,1),n.m(s.parentNode,s))},i(a){i||(S(n),i=!0)},o(a){E(n),i=!1},d(a){a&&w(s),l[e].d(a)}}}function De(r){let e,n;return e=new X({props:{title:"1. Accept Connection",isOpen:!r[7],$$slots:{default:[ve]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},l(s){M(e.$$.fragment,s)},m(s,i){q(e,s,i),n=!0},p(s,i){const t={};i&128&&(t.isOpen=!s[7]),i&536870956&&(t.$$scope={dirty:i,ctx:s}),e.$set(t)},i(s){n||(S(e.$$.fragment,s),n=!0)},o(s){E(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function ke(r){let e,n,s,i;return e=new X({props:{title:r[7]?"Connected":"Connection",isOpen:!r[7]||r[2],$$slots:{default:[De]},$$scope:{ctx:r}}}),s=new fe({props:{sender:r[11],receiver:r[10],content:r[6],isConnecting:r[7],showNewFile:r[4],dataChannel:r[8],rsaPub:r[1],rsa:r[0],handleInput:r[13],sendOptions:r[9]}}),{c(){A(e.$$.fragment),n=F(),A(s.$$.fragment)},l(t){M(e.$$.fragment,t),n=Q(t),M(s.$$.fragment,t)},m(t,l){q(e,t,l),P(t,n,l),q(s,t,l),i=!0},p(t,[l]){const d={};l&128&&(d.title=t[7]?"Connected":"Connection"),l&132&&(d.isOpen=!t[7]||t[2]),l&536871084&&(d.$$scope={dirty:l,ctx:t}),e.$set(d);const a={};l&64&&(a.content=t[6]),l&128&&(a.isConnecting=t[7]),l&16&&(a.showNewFile=t[4]),l&256&&(a.dataChannel=t[8]),l&2&&(a.rsaPub=t[1]),l&1&&(a.rsa=t[0]),s.$set(a)},i(t){i||(S(e.$$.fragment,t),S(s.$$.fragment,t),i=!0)},o(t){E(e.$$.fragment,t),E(s.$$.fragment,t),i=!1},d(t){t&&w(n),N(e,t),N(s,t)}}}function Pe(r,e,n){let s=V,i=V.isEncrypt;V.chunkSize;let t,l,d=V.iceServer,a="",f=!1,g,_,b=!1,h,D="";const L=new URLSearchParams(window.location.search),m=Object.fromEntries(L.entries()),y=m.s;if(y===null||!y)throw window.location.assign(window.location.origin),new Error("no sdp found");const I=m.i;I&&(d=I),m.c;const B=m.p;B?(i=!0,pe(B).then(p=>{n(1,l=p)})):i=!1;const $=new RTCPeerConnection({iceServers:[{urls:d}]});let o=!1,c;$.ondatachannel=p=>{n(8,c=p.channel),n(8,c.onopen=()=>{z("Connected","success"),n(7,o=!0),h.close()},c),n(8,c.onmessage=C=>{if(typeof C.data=="string"){const u=JSON.parse(C.data);u.type==="clipboard"&&n(6,D=u.data)}else if(C.data instanceof ArrayBuffer){const u=ue.decode(new Uint8Array(C.data));u.metaData!==void 0?(g.onMetaData(u.id,u.metaData),n(4,b=!0)):u.chunk!==void 0?g.onChunkData(u.id,u.chunk):u.receiveEvent!==void 0&&_.onReceiveEvent(u.id,u.receiveEvent)}},c),n(8,c.onerror=()=>{z("WebRTC error","error"),n(7,o=!1)},c),n(8,c.onclose=()=>{z("Disconnected","error"),n(7,o=!1)},c)};async function T(p){const u={type:"offer",sdp:de(p,!0)};await $.setRemoteDescription(u)}T(y);async function v(){await navigator.clipboard.writeText(a),z("Copied to clipboard","info")}async function H(){let p="";i&&(n(0,t=await me()),p=await ge(t.publicKey)),$.onicecandidate=u=>{!u.candidate&&$.localDescription&&n(2,a=G($.localDescription.sdp)+"|"+p)};const C=await $.createAnswer();await $.setLocalDescription(C),setTimeout(async()=>{!$.localDescription||a||(z("Timeout waiting ICE candidates"),n(2,a=G($.localDescription.sdp)+"|"+p))},_e)}H();function Y(p){const C=p.target;n(6,D=C.value),Z(D)}function Z(p){if(c&&c.readyState==="open"){const C=JSON.stringify({type:"clipboard",data:p});c.send(C)}}const x=p=>{n(3,f=p)};function ee(p){ae[p?"unshift":"push"](()=>{h=p,n(5,h)})}return[t,l,a,f,b,h,D,o,c,s,g,_,v,Y,x,ee]}class Te extends te{constructor(e){super(),ne(this,e,Pe,ke,se,{})}}export{Te as default};
